<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vLLM Ascend Playground</title>
    <link rel="stylesheet" href="/static/css/style.css?v=20260104">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="logo">
                <h1>🚀 vLLM Ascend</h1>
                <span class="subtitle">Playground</span>
            </div>
            <nav class="nav-menu">
                <a href="#" class="nav-item active" data-tab="dashboard">
                    <span class="icon">📊</span><span>仪表盘</span>
                </a>
                <a href="#" class="nav-item" data-tab="containers">
                    <span class="icon">🐳</span><span>容器管理</span>
                </a>
                <a href="#" class="nav-item" data-tab="models">
                    <span class="icon">🤖</span><span>模型管理</span>
                </a>
                <a href="#" class="nav-item" data-tab="vllm">
                    <span class="icon">⚡</span><span>vLLM 服务</span>
                </a>
                <a href="#" class="nav-item" data-tab="benchmark">
                    <span class="icon">📈</span><span>性能测试</span>
                </a>
                <a href="#" class="nav-item" data-tab="chat">
                    <span class="icon">💬</span><span>AI 对话</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <div class="status-indicator">
                    <span class="status-dot" id="service-status"></span>
                    <span id="status-text">服务状态检测中...</span>
                </div>
            </div>
        </aside>
        
        <main class="main-content">
            <!-- 仪表盘 -->
            <section id="dashboard" class="tab-content active">
                <h2>系统概览</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">🔥</div>
                        <div class="stat-info">
                            <h3>NPU 状态</h3>
                            <div id="npu-count">检测中...</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">🐳</div>
                        <div class="stat-info">
                            <h3>运行容器</h3>
                            <div id="container-count">0</div>
                        </div>
                    </div>
                    <div class="stat-card clickable" id="dashboard-vllm-card">
                        <div class="stat-icon">⚡</div>
                        <div class="stat-info">
                            <h3>vLLM 服务</h3>
                            <div id="vllm-status">0 个运行中</div>
                        </div>
                    </div>
                </div>
                <div class="dashboard-grid">
                    <div class="card">
                        <h3>NPU 占用状态</h3>
                        <div id="npu-status-grid" class="npu-status-grid"></div>
                    </div>
                </div>
            </section>
            
            <!-- 容器管理 -->
            <section id="containers" class="tab-content">
                <h2>容器管理</h2>
                <div class="toolbar">
                    <div class="search-box">
                        <input type="text" id="container-filter" placeholder="🔍 搜索容器...">
                        <label class="checkbox-label">
                            <input type="checkbox" id="show-running-only"> 仅运行中
                        </label>
                    </div>
                    <button class="btn btn-primary" id="btn-create-container">➕ 创建容器</button>
                    <button class="btn btn-success" id="btn-pull-image">📥 下载镜像</button>
                    <button class="btn btn-secondary" id="btn-refresh-containers">🔄 刷新</button>
                </div>
                <div class="card">
                    <h3>容器列表 <span id="container-count-display" class="count-display"></span></h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>名称</th>
                                <th>镜像</th>
                                <th>状态</th>
                                <th>创建时间</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="containers-table"></tbody>
                    </table>
                </div>
            </section>
            
            <!-- 模型管理 -->
            <section id="models" class="tab-content">
                <h2>模型管理</h2>
                <div class="toolbar">
                    <div class="search-box">
                        <input type="text" id="model-filter" placeholder="🔍 搜索模型...">
                    </div>
                    <button class="btn btn-primary" id="btn-download-model">⬇️ 下载模型</button>
                    <button class="btn btn-secondary" id="btn-refresh-models">🔄 刷新</button>
                </div>
                <div class="model-tabs">
                    <button class="model-tab active" data-source="local">本地模型</button>
                    <button class="model-tab" data-source="modelscope">ModelScope 缓存</button>
                    <button class="model-tab" data-source="popular">常用模型</button>
                </div>
                <div class="card">
                    <div id="models-list" class="models-grid"></div>
                </div>
            </section>
            
            <!-- vLLM 服务 -->
            <section id="vllm" class="tab-content">
                <h2>vLLM 服务配置</h2>
                <div class="card">
                    <h3>启动配置</h3>
                    <form id="vllm-config-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>选择容器</label>
                                <select id="vllm-container" required>
                                    <option value="">请选择容器</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>模型来源</label>
                                <select id="model-source-type">
                                    <option value="local">本地模型</option>
                                    <option value="modelscope">ModelScope</option>
                                </select>
                            </div>
                            <div class="form-group" id="local-model-group">
                                <label>本地模型路径</label>
                                <input type="text" id="local-model-path" placeholder="/data2/weights/Qwen3-0.6B">
                            </div>
                            <div class="form-group" id="modelscope-model-group" style="display:none">
                                <label>ModelScope 模型 ID</label>
                                <input type="text" id="modelscope-model-id" placeholder="Qwen/Qwen3-0.6B">
                            </div>
                            <div class="form-group">
                                <label>服务名称</label>
                                <input type="text" id="served-model-name" value="default-model">
                            </div>
                            <div class="form-group">
                                <label>端口</label>
                                <input type="number" id="vllm-port" value="8000">
                            </div>
                            <div class="form-group">
                                <label>NPU 设备</label>
                                <div class="npu-selector" id="npu-selector"></div>
                            </div>
                            <div class="form-group">
                                <label>Tensor Parallel Size</label>
                                <input type="number" id="tensor-parallel-size" value="1" min="1" max="16">
                            </div>
                            <div class="form-group">
                                <label>最大模型长度</label>
                                <input type="number" id="max-model-len" placeholder="自动检测">
                            </div>
                            <div class="form-group">
                                <label>数据类型</label>
                                <select id="dtype">
                                    <option value="auto">auto</option>
                                    <option value="float16">float16</option>
                                    <option value="bfloat16">bfloat16</option>
                                </select>
                            </div>
                            <div class="form-group full-width">
                                <label>
                                    <input type="checkbox" id="trust-remote-code" checked> Trust Remote Code
                                </label>
                            </div>
                            <div class="form-group full-width">
                                <label>额外参数</label>
                                <input type="text" id="additional-args" placeholder="--enable-prefix-caching">
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary" id="start-vllm-btn">🚀 启动 vLLM</button>
                            <button type="button" class="btn btn-danger" id="stop-vllm-btn">⏹️ 停止所有</button>
                        </div>
                    </form>
                </div>
                <div class="card">
                    <h3>生成的启动命令</h3>
                    <pre id="generated-command" class="command-preview">选择模型后显示命令...</pre>
                </div>
                <div class="card">
                    <h3>🚀 运行中的服务 <span id="running-service-count" class="badge">0</span></h3>
                    <div id="services-list">
                        <p class="placeholder">暂无运行中的服务</p>
                    </div>
                </div>
            </section>
            
            <!-- 性能测试 -->
            <section id="benchmark" class="tab-content">
                <h2>性能测试</h2>
                <div class="card">
                    <h3>测试配置</h3>
                    <form id="benchmark-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>测试类型</label>
                                <select id="benchmark-type">
                                    <option value="evalscope">EvalScope Perf</option>
                                    <option value="vllm_bench">vLLM Bench</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>服务 URL</label>
                                <input type="text" id="benchmark-url" value="http://localhost:8000/v1/chat/completions">
                            </div>
                            <div class="form-group">
                                <label>模型名称</label>
                                <input type="text" id="benchmark-model-name" value="default-model">
                            </div>
                        </div>
                        <div id="evalscope-params" class="form-grid">
                            <div class="form-group">
                                <label>并发数</label>
                                <input type="number" id="eval-parallel" value="1" min="1">
                            </div>
                            <div class="form-group">
                                <label>请求数量</label>
                                <input type="number" id="eval-number" value="10" min="1">
                            </div>
                            <div class="form-group">
                                <label>数据集</label>
                                <select id="eval-dataset">
                                    <option value="openqa">OpenQA</option>
                                    <option value="longalpaca">LongAlpaca</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>温度 (Temperature)</label>
                                <input type="number" id="eval-temperature" value="0" min="0" max="2" step="0.1">
                            </div>
                        </div>
                        <div id="vllm-bench-params" class="form-grid" style="display:none">
                            <div class="form-group">
                                <label>请求速率</label>
                                <input type="number" id="bench-request-rate" value="1" min="0.1" step="0.1">
                            </div>
                            <div class="form-group">
                                <label>最大并发</label>
                                <input type="number" id="bench-max-concurrency" value="1" min="1">
                            </div>
                            <div class="form-group">
                                <label>提示数量</label>
                                <input type="number" id="bench-num-prompts" value="5" min="1">
                            </div>
                            <div class="form-group">
                                <label>输入长度</label>
                                <input type="number" id="bench-input-len" value="1024" min="1">
                            </div>
                            <div class="form-group">
                                <label>输出长度</label>
                                <input type="number" id="bench-output-len" value="1024" min="1">
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">▶️ 开始测试</button>
                        </div>
                    </form>
                </div>
                <div class="card">
                    <h3>测试模板</h3>
                    <div id="benchmark-templates" class="templates-grid"></div>
                </div>
                <div class="card">
                    <h3>测试结果</h3>
                    <div id="benchmark-results">
                        <p class="placeholder">运行测试后显示结果</p>
                    </div>
                </div>
                <div class="card">
                    <h3>历史记录 <span id="benchmark-count" class="badge">0</span></h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>时间</th>
                                <th>类型</th>
                                <th>吞吐量</th>
                                <th>平均延迟</th>
                                <th>P99 延迟</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="benchmark-history"></tbody>
                    </table>
                </div>
            </section>
            
            <!-- AI 对话 -->
            <section id="chat" class="tab-content">
                <h2>AI 对话</h2>
                <div class="grid-2">
                    <div class="card">
                        <h3>对话设置</h3>
                        <div class="form-group">
                            <label>服务 URL</label>
                            <input type="text" id="chat-url" value="http://localhost:8000" placeholder="http://localhost:8000">
                        </div>
                        <div class="form-group">
                            <label>模型名称</label>
                            <input type="text" id="chat-model" value="default-model" placeholder="模型名称">
                            <button class="btn btn-sm btn-secondary" id="btn-fetch-models" style="margin-top:0.5rem">获取模型列表</button>
                        </div>
                        <div class="form-group">
                            <label>温度 (Temperature): <span id="temp-value">0.7</span></label>
                            <input type="range" id="chat-temperature" min="0" max="2" step="0.1" value="0.7">
                        </div>
                        <div class="form-group">
                            <label>最大 Token 数</label>
                            <input type="number" id="chat-max-tokens" value="2048" min="1" max="32768">
                        </div>
                        <button class="btn btn-secondary" id="btn-clear-chat">🗑️ 清空对话</button>
                    </div>
                    <div class="card chat-card">
                        <h3>对话窗口</h3>
                        <div id="chat-messages" class="chat-messages">
                            <p class="placeholder">输入消息开始对话...</p>
                        </div>
                        <div class="chat-input-area">
                            <input type="text" id="chat-input" placeholder="输入消息...">
                            <button class="btn btn-primary" id="btn-send-chat">发送</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>
    
    <!-- 创建容器模态框 -->
    <div id="create-container-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>创建新容器</h3>
                <button class="close-btn" data-modal="create-container-modal">&times;</button>
            </div>
            <form id="create-container-form">
                <div class="form-group">
                    <label>容器名称</label>
                    <input type="text" id="new-container-name" required placeholder="my-vllm-container">
                </div>
                <div class="form-group">
                    <label>镜像</label>
                    <select id="new-container-image">
                        <option value="quay.io/ascend/vllm-ascend:v0.13.0rc1">vLLM Ascend v0.13.0rc1</option>
                        <option value="quay.io/ascend/vllm-ascend:v0.12.0">vLLM Ascend v0.12.0</option>
                        <option value="quay.io/ascend/vllm-ascend:latest">vLLM Ascend Latest</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>NPU 设备</label>
                    <div class="npu-checkbox-group" id="modal-npu-selector"></div>
                </div>
                <div class="form-group">
                    <label>共享内存大小</label>
                    <input type="text" id="new-container-shm" value="1g">
                </div>
                <div class="form-group">
                    <label>挂载目录</label>
                    <input type="text" id="new-container-volumes" placeholder="/data:/data">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" data-modal="create-container-modal">取消</button>
                    <button type="submit" class="btn btn-primary">创建</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- 下载镜像模态框 -->
    <div id="pull-image-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>下载容器镜像</h3>
                <button class="close-btn" data-modal="pull-image-modal">&times;</button>
            </div>
            <form id="pull-image-form">
                <div class="form-group">
                    <label>镜像地址</label>
                    <input type="text" id="pull-image-name" placeholder="例如: quay.io/ascend/vllm-ascend:v0.13.0rc1" required>
                </div>
                <div class="form-group">
                    <label>常用镜像</label>
                    <div class="quick-images">
                        <button type="button" class="btn btn-sm btn-outline quick-image-btn" data-image="quay.io/ascend/vllm-ascend:v0.13.0rc1">v0.13.0rc1</button>
                        <button type="button" class="btn btn-sm btn-outline quick-image-btn" data-image="quay.io/ascend/vllm-ascend:v0.12.0rc1">v0.12.0rc1</button>
                        <button type="button" class="btn btn-sm btn-outline quick-image-btn" data-image="quay.io/ascend/vllm-ascend:v0.11.0rc2">v0.11.0rc2</button>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" data-modal="pull-image-modal">取消</button>
                    <button type="submit" class="btn btn-primary" id="pull-image-btn">📥 开始下载</button>
                </div>
            </form>
            <div id="pull-progress" style="display:none; margin-top: 15px;">
                <div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div>
                <p id="pull-status" style="text-align: center; margin-top: 10px;">正在下载...</p>
            </div>
        </div>
    </div>
    
    <!-- 下载模型模态框 -->
    <div id="download-model-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>下载模型</h3>
                <button class="close-btn" data-modal="download-model-modal">&times;</button>
            </div>
            <form id="download-model-form">
                <div class="form-group">
                    <label>模型 ID</label>
                    <input type="text" id="download-model-id" required placeholder="Qwen/Qwen2-7B-Instruct">
                </div>
                <div class="form-group">
                    <label>来源</label>
                    <select id="download-source">
                        <option value="modelscope">ModelScope</option>
                        <option value="huggingface">HuggingFace</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>下载目录 <span class="hint">(留空使用默认缓存目录)</span></label>
                    <input type="text" id="download-cache-dir" placeholder="/data2/weights 或留空">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" data-modal="download-model-modal">取消</button>
                    <button type="submit" class="btn btn-primary">开始下载</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Toast 通知容器 -->
    <div id="toast-container"></div>
    
    <script src="/static/js/app.js?v=20260104"></script>
</body>
</html>
